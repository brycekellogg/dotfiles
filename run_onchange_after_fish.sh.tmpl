#!/bin/bash
# vim: syntax=bash

# To trigger a re-run of this script when one of the config files changes, we
# use the template system to include a checksum of the config file. If the config
# file changes, the checksum changes, so this files changes, so it re-runs. Details
# of this technique can be found below in the link:
# https://www.chezmoi.io/user-guide/use-scripts-to-perform-actions/#install-packages-with-scripts
#
# fish config hash {{ include "private_dot_config/fish/config.fish.tmpl" | sha256sum }}


# Set bash to exit on the first error & print an error
# message detailing which command produced the error.
set -e
trap 'last_command=$current_command; current_command=$BASH_COMMAND' DEBUG
trap 'echo "\"${last_command}\" command failed with exit code $?."' ERR

# Check that the required packages are installed
echo "Fish: check for required tools..."
command -v fish
command -v curl

# Fish should have already been installed
# (via package manager), here we instal the
# plugin manager (fisher) that will be used.
echo "Fish: download & install plugin manager..."
FISHER_URL="https://git.io/fisher"
FISHER_SCRIPT="/tmp/fisher"
curl -sLo $FISHER_SCRIPT $FISHER_URL
fish -c "source $FISHER_SCRIPT && fisher install jorgebucaran/fisher"
rm -rf $FISHER_SCRIPT

# Install & update fish plugins
echo "Fish: install & update plugins..."
fish -c "fisher install ilancosman/tide@v5"
fish -c "fisher install edc/bass"
fish -c "fisher update"


############################
### Change shell to fish ###
############################
# echo -n "Changing shell to fish..."
# run "sudo chsh -s $(which fish) $USER"
# echo " done"

